import{_ as J,Q as re}from"./_plugin-vue_export-helper-CWuwXdpK.js";import{r as v,c as U,a2 as ie,d as q,w as g,D as $,L as _,C as i,I as ne,Q as oe,a3 as ue,M as Z,A as B,B as T,a4 as G,f as m,z as W,H as f,G as r,o as ce,a5 as de,a6 as pe,F as fe,N as me,Z as ve}from"./index-XAvQvGti.js";import{d as w,u as X,k as ge,l as he,_ as Y,Q as ee}from"./ModalDefault.vue_vue_type_script_setup_true_lang-CQmJYR-v.js";import{Q as V}from"./QBtn-l7PP0WXU.js";import"./firebase-C3Lyi9zm.js";const te=60,ae=5,k=v(te),D=v(ae),E=U(()=>{const e=Math.floor(k.value/60),t=k.value%60;return`${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}`}),xe=U(()=>{const e=D.value%60;return`${String(e).padStart(2,"0")}`}),le=U(()=>k.value<=0);let F=null,I=null;const j=()=>{clearInterval(F),k.value=te},se=()=>{clearInterval(I),D.value=ae};function K(){return{mounted:()=>{j(),F=setInterval(()=>{k.value>=0?k.value--:clearInterval(F)},1e3)},mountedStart:()=>{se(),I=setInterval(()=>{D.value>0?D.value--:clearInterval(I)},1e3)},unmounted:()=>{clearInterval(F),clearInterval(I)},isTimeOver:le}}const A=ie("game",{state:()=>({currentScore:0,pulseTimerList:["01:30","01:00","00:30"],attemptCounter:0,currentLevel:1,gameStartTime:null,gameEndTime:null,initialFlip:!1,lockBoard:!1,flippedStatus:[],flippedCards:[],cardRefs:[],baseFruits:[{src:"fruits/abacaxi.png",alt:"abacaxi"},{src:"fruits/banana.png",alt:"banana"},{src:"fruits/beterraba.png",alt:"beterraba"},{src:"fruits/carambola.png",alt:"carambola"},{src:"fruits/cereja.png",alt:"cereja"},{src:"fruits/kiwi.png",alt:"kiwi"},{src:"fruits/laranja.png",alt:"laranja"},{src:"fruits/limao.png",alt:"limao"},{src:"fruits/manga.png",alt:"manga"},{src:"fruits/melancia.png",alt:"melancia"},{src:"fruits/mixirica.png",alt:"mixirica"},{src:"fruits/morango.png",alt:"morango"},{src:"fruits/pera.png",alt:"pera"},{src:"fruits/pessego.png",alt:"pessego"},{src:"fruits/pitaia.png",alt:"pitaia"},{src:"fruits/tamarindo.png",alt:"tamarindo"},{src:"fruits/uva.png",alt:"uva"},{src:"fruits/uva_roxa.png",alt:"uva roxa"},{src:"fruits/uva_verde.png",alt:"uva verde"}],levelsConfig:[{level:1,gridSize:4,pairs:8},{level:2,gridSize:6,pairs:18},{level:3,gridSize:8,pairs:24},{level:4,gridSize:8,pairs:32}]}),getters:{currentConfig(e){return e.levelsConfig.find(a=>a.level===e.currentLevel)??e.levelsConfig[0]},gridSize(e){return e.levelsConfig.find(t=>t.level===e.currentLevel)?.gridSize||4},totalCards(e){return(e.levelsConfig.find(a=>a.level===e.currentLevel)?.pairs||8)*2},levelCardSet(e){const t=e.levelsConfig.find(l=>l.level===e.currentLevel)?.pairs||8,a=e.baseFruits.slice(0,t);return[...a,...a]},gameDuration(e){return e.gameStartTime!==null&&e.gameEndTime!==null?e.gameEndTime-e.gameStartTime:null}},actions:{startGameEffects(){this.setFlippedStatus();const{audioCard:e,playMusic:t}=w();t(),this.initialFlip=!1,this.lockBoard=!0,setTimeout(()=>{this.gameStartTime=Date.now(),e(),this.initialFlip=!0,K().mountedStart(),setTimeout(()=>{e(),this.initialFlip=!1,K().mounted(),this.lockBoard=!1},5e3)},600)},incrementScore(e){const t=this.calculateScore(e);this.currentScore+=t},calculateScore(e){return e>="00:50"?5:e>="00:40"?4:e>="00:30"?3:e>="00:20"?2:e>="00:05"?1:0},nextLevel(){const e=this.levelsConfig.length;this.currentLevel<e&&this.currentLevel++},resetLevel(){this.currentScore=0,this.attemptCounter=0,this.currentScore=0,j(),se(),this.setFlippedStatus(),this.startGameEffects()},setFlippedStatus(){this.flippedStatus=Array(this.totalCards).fill(!1)},async endGame(){const e=X();this.gameEndTime=Date.now(),e.getUser?.uid&&await e.updateRanking(e.getUser.uid,{score:this.currentScore,gameTotal:this.gameDuration,attemptCounter:this.attemptCounter,...e.getUser})},onFlip({index:e,alt:t}){if(!this.lockBoard&&(this.flippedCards.push({index:e,alt:t}),this.flippedCards.length===2)){this.attemptCounter=this.attemptCounter+1,this.lockBoard=!0;const[a,l]=this.flippedCards;a&&l&&(a.alt===l.alt?(this.flippedStatus[a.index]=!0,this.flippedStatus[l.index]=!0,this.flippedCards=[],this.lockBoard=!1,this.incrementScore(E.value),j(),w().audioPair()):setTimeout(()=>{this.cardRefs[a.index]?.flipDown(),this.cardRefs[l.index]?.flipDown(),this.flippedCards=[],this.lockBoard=!1},1e3))}}}}),Se={class:"card-inner"},_e={class:"card-face card-front"},ye=["src","alt"],Ce=q({__name:"CardIndex",props:{card:{},index:{},flippedExternally:{type:Boolean},locked:{type:Boolean}},emits:["flip"],setup(e,{expose:t,emit:a}){const l=e,c=a,{audioCard:d}=w(),o=v(!1);g(()=>l.flippedExternally,y=>{o.value=y},{immediate:!0});const u=U(()=>o.value?"flip-up":"flip-down");function h(){l.locked||o.value||(o.value=!0,d(),c("flip",{index:l.index,alt:l.card.alt}))}return t({flipDown:()=>{d(),o.value=!1}}),(y,C)=>(_(),$("div",{class:ne(["card-container",u.value]),onClick:h,style:{"min-height":"60px","min-width":"60px"}},[i("div",Se,[C[0]||(C[0]=i("div",{class:"card-face card-back"},null,-1)),i("div",_e,[i("img",{src:l.card.src,alt:l.card.alt,class:"card-img full-width full-height",width:"80",height:"80",loading:"lazy",style:{"max-width":"80px","max-height":"80px"}},null,8,ye)])])],2))}}),be=J(Ce,[["__scopeId","data-v-bf6819fa"]]);function H(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}const P=oe({name:"close-popup",beforeMount(e,{value:t}){const a={depth:H(t),handler(l){a.depth!==0&&setTimeout(()=>{const c=ge(e);c!==void 0&&he(c,l,a.depth)})},handlerKey(l){ue(l,13)===!0&&a.handler(l)}};e.__qclosepopup=a,e.addEventListener("click",a.handler),e.addEventListener("keyup",a.handlerKey)},updated(e,{value:t,oldValue:a}){t!==a&&(e.__qclosepopup.depth=H(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}}),Te=q({__name:"ModalFailedGame",props:{modelValue:{default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(e){const t=Z(e,"modelValue"),{audioGameOver:a,audioCongratulation:l}=w(),c=A();function d(){l().pause(),c.resetLevel()}return g(t,o=>{o&&a()},{immediate:!0}),(o,u)=>(_(),B(Y,{modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=h=>t.value=h),title:"",icon:"","class-body":"flex column items-center text-center q-px-lg","class-actions":"flex justify-center q-pa-lg"},{default:T(()=>[m(ee,{srcset:"failedGame.gif",alt:"Happy Birthday",width:"140",height:"140",class:"full-width full-height",style:{"max-width":"140px","max-height":"140px"}}),u[1]||(u[1]=i("p",{class:"text-h4 text-bold text-red-8"},"Você falhou!",-1)),u[2]||(u[2]=i("p",{class:"text-body2 text-bold text-principal"}," Mas não desanime, você pode tentar novamente! ",-1))]),actions:T(()=>[G(m(V,{label:"menu principal",color:"cyan-6",to:"/"},null,512),[[P]]),G(m(V,{label:"jogar novamente",color:"amber-7",onClick:d},null,512),[[P]])]),_:1},8,["modelValue"]))}}),ke={class:"text-h5 text-bold text-principal q-px-lg"},we={class:"flex justify-center",style:{gap:"10px"}},Le=q({__name:"ModalNextLevel",props:{showModal:{default:!1},showModalModifiers:{}},emits:["update:showModal"],setup(e){const t=Z(e,"showModal"),{audioCongratulation:a}=w(),l=A(),{currentScore:c,currentLevel:d,attemptCounter:o,gameEndTime:u,gameStartTime:h}=W(l);function y(){a().pause(),l.resetLevel()}function C(){a().pause(),d.value=d.value+1,l.resetLevel()}return g(t,x=>{x&&a()}),(x,b)=>(_(),B(Y,{modelValue:t.value,"onUpdate:modelValue":b[0]||(b[0]=z=>t.value=z),title:"",icon:"","class-body":"flex column items-center text-center q-px-lg","class-actions":"flex justify-center q-pa-lg"},{default:T(()=>[m(ee,{srcset:"happy_birthday.gif",alt:"Happy Birthday",width:"360",height:"360",class:"full-width full-height",style:{"max-width":"250px","max-height":"250px"}}),b[1]||(b[1]=i("p",{class:"text-h4 text-bold text-principal"},"Parabéns!",-1)),i("p",ke," Você conquistou o nível "+f(r(d)),1),i("div",we,[i("p",null,"Pontuação: "+f(r(c)),1),i("p",null,"Tentivas: "+f(r(o)),1),i("p",null,"inicio: "+f(r(h)),1),i("p",null,"fim: "+f(r(u)),1)])]),actions:T(()=>[G(m(V,{label:"Jogar novamente",color:"amber-7","text-color":"black",onClick:y},null,512),[[P]]),G(m(V,{label:"Proximo Nivel",color:"cyan-6",onClick:C},null,512),[[P]])]),_:1},8,["modelValue"]))}}),Me={class:"flex justify-between text-principal q-pt-md"},Ee=q({__name:"StartGamePage",setup(e){const t=de(),a=A(),{initialFlip:l,currentScore:c,gridSize:d,levelCardSet:o,currentLevel:u,totalCards:h,lockBoard:y,attemptCounter:C,flippedStatus:x,cardRefs:b}=W(a),z=X(),L=v(!1),R=v(!1),N=v(0),M=v(!1);function Q(n){const s=[...n];for(let p=s.length-1;p>0;p--){const S=Math.floor(Math.random()*(p+1));[s[p],s[S]]=[s[S],s[p]]}return s}const O=v(Q([...o.value]));return g(E,n=>{a.pulseTimerList.forEach(s=>{n===s&&(R.value=!0,setTimeout(()=>{R.value=!1},2e3))})}),g(o,n=>{O.value=Q([...n]),x.value.splice(0,x.value.length,...Array(n.length).fill(!1))}),g(()=>x.value,async n=>{console.log(n),console.log(n.every(s=>s)),n.every(s=>s)&&(L.value=!0,await a.endGame())},{deep:!0}),g(l,n=>{if(n){const s=setInterval(()=>{N.value++},600);setTimeout(()=>{clearInterval(s)},5e3)}}),g(le,n=>{n&&!L.value&&(M.value=!M.value)}),ce(async()=>{z.getUser?a.startGameEffects():await t.push("/")}),(n,s)=>(_(),B(re,{class:"--container"},{default:T(()=>[i("section",null,[i("div",{class:"--grid",style:pe({gridTemplateColumns:`repeat(${r(d)}, minmax(20px, 1fr))`})},[(_(!0),$(fe,null,me(r(h),(p,S)=>(_(),B(be,{key:S,index:S,card:O.value[S]??{src:"",alt:""},"flipped-externally":r(l)||r(x)[S],locked:r(y),onFlip:r(a).onFlip,ref_for:!0,ref_key:"cardRefs",ref:b},null,8,["index","card","flipped-externally","locked","onFlip"]))),128))],4),i("div",Me,[i("p",null,"Nivel: "+f(r(u)),1),i("p",null,"Pontuação: "+f(r(c)),1),i("p",null,"Tentativas: "+f(r(C)),1),m(ve,{name:"time-pulse",mode:"out-in"},{default:T(()=>[(_(),$("p",{key:r(l)?"pulse-"+N.value:r(E),class:"text-bold"},f(r(l)?r(xe):r(E)),1))]),_:1})])]),m(Le,{showModal:L.value,"onUpdate:showModal":s[0]||(s[0]=p=>L.value=p)},null,8,["showModal"]),m(Te,{modelValue:M.value,"onUpdate:modelValue":s[1]||(s[1]=p=>M.value=p)},null,8,["modelValue"])]),_:1}))}}),De=J(Ee,[["__scopeId","data-v-3eb55c01"]]);export{De as default};
