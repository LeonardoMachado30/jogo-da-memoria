import{r as v,$ as w,a0 as _}from"./index-C4pjdHuE.js";import{r as u,d as i,g as p,u as S,s as f,a as h,b as U,G as b,c as C,q as M,o as R,l as E}from"./firebase-CPFhDrGW.js";const n=new Audio("audio/lofi-coffee-332824.mp3");n.loop=!0;const T=localStorage.getItem("isPauseMusic"),l=v(!!T),d=v(.5);n.volume=d.value;const c=new Map;function m(){n.play().then(()=>{l.value=!0,localStorage.removeItem("isPauseMusic")}).catch(e=>{console.warn("Autoplay bloqueado:",e)})}function g(){n.pause(),l.value=!1,localStorage.setItem("isPauseMusic",String(!0))}function A(){l.value?g():m()}function I(e){d.value=e,n.volume=e;for(const r of c.values())r.volume=e}function s(e,r=!0){let o=c.get(e);return o||(o=new Audio(e),o.volume=d.value,c.set(e,o)),r&&(o.currentTime=0,o.play().catch(a=>{console.warn("Audio play blocked:",a)})),o}function x(){s("audio/card-sounds-35956.mp3")}function P(){const e=s("audio/crowd-cheer-ii-6263.mp3");return g(),setTimeout(()=>{m()},3e3),e}function G(){s("audio/success-1-6297.mp3")}function O(){s("audio/658431__deathbyfairydust__pop.wav")}function $(){s("audio/801967__sadiquecat__kid-fingersnap-3.wav")}function q(){s("audio/253886__themusicalnomad__negative_beeps.wav"),g()}function j(){return{isPlaying:l,volume:d,playMusic:m,pauseMusic:g,toggleMusic:A,setVolume:I,audioCard:x,audioCongratulation:P,audioPair:G,audioMouseHover:O,audioClick:$,audioGameOver:q,audioMap:c}}const y=e=>u(i,`users/${e}`),z=u(i,"ranking"),B=w("user",{state:()=>({user:null}),getters:{getUser:e=>{if(e.user)return e.user;const r=localStorage.getItem("user");if(!r)return null;try{const o=JSON.parse(r);if(o&&typeof o=="object")return o}catch(o){return console.error("Erro ao fazer parse do usuário:",o),null}}},actions:{setUser(e){localStorage.setItem("user",JSON.stringify(e)),this.user=e},async addUser(e,r){try{await f(y(e),r)}catch(o){console.error("Erro ao adicionar usuário:",o)}},async getUserData(e){try{const r=await p(y(e));return r.exists()?r.val():null}catch(r){return console.error("Erro ao obter usuário:",r),null}},async getTop10Ranking(){try{const e=M(z,R("score"),E(10)),r=await p(e);if(r.exists()){const o=r.val();return Object.entries(o).map(([a,t])=>({...t,id:a})).sort((a,t)=>(t.score??0)-(a.score??0))}else return[]}catch(e){return console.error("Erro ao obter ranking:",e),[]}},async loginWithGoogle(){try{const e=h(),r=new b,o=await C(e,r),a={nome:o.user.displayName,email:o.user.email,photoURL:o.user.photoURL,uid:o.user.uid};await this.getUserData(o.user.uid)||(await this.addUser(o.user.uid,a),await this.addRaking(o.user.uid,{score:0,gameTotal:0,attemptCounter:0,...a})),this.setUser(a)}catch(e){console.error("Erro no login com Google:",e)}},async logout(){const e=_();try{const r=h();await U(r),this.user=null,localStorage.removeItem("user"),await e.push("/")}catch(r){console.error("Erro ao fazer logout:",r)}},async addRaking(e,r){try{await f(u(i,`ranking/${e}`),r)}catch(o){console.error("Erro ao adicionar ranking:",o)}},async updateRanking(e,r){try{const o=u(i,`ranking/${e}`),a=await p(o),t=a.exists()?a.val():null,k={attemptCounter:t.attemptCounter+r.attemptCounter,gameTotal:t.gameTotal+r.gameTotal,score:t.score+r.score};await S(o,k)}catch(o){console.error("Erro ao atualizar ranking:",o)}}}});export{j as a,B as u};
