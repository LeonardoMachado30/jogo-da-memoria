import{r as v,a0 as w}from"./index-n20uJ8Zo.js";import{r as i,d as u,g as p,u as _,s as m,a as h,b as S,G as U,c as b,q as C,o as M,l as R}from"./firebase-BFcpTBpt.js";const n=new Audio("audio/lofi-coffee-332824.mp3");n.loop=!0;const E=localStorage.getItem("isPauseMusic"),l=v(!!E),d=v(.5);n.volume=d.value;const c=new Map;function f(){n.play().then(()=>{l.value=!0,localStorage.removeItem("isPauseMusic")}).catch(e=>{console.warn("Autoplay bloqueado:",e)})}function g(){n.pause(),l.value=!1,localStorage.setItem("isPauseMusic",String(!0))}function T(){l.value?g():f()}function A(e){d.value=e,n.volume=e;for(const r of c.values())r.volume=e}function s(e,r=!0){let o=c.get(e);return o||(o=new Audio(e),o.volume=d.value,c.set(e,o)),r&&(o.currentTime=0,o.play().catch(a=>{console.warn("Audio play blocked:",a)})),o}function I(){s("audio/card-sounds-35956.mp3")}function x(){const e=s("audio/crowd-cheer-ii-6263.mp3");return g(),setTimeout(()=>{f()},3e3),e}function P(){s("audio/success-1-6297.mp3")}function G(){s("audio/658431__deathbyfairydust__pop.wav")}function O(){s("audio/801967__sadiquecat__kid-fingersnap-3.wav")}function q(){s("audio/253886__themusicalnomad__negative_beeps.wav"),g()}function N(){return{isPlaying:l,volume:d,playMusic:f,pauseMusic:g,toggleMusic:T,setVolume:A,audioCard:I,audioCongratulation:x,audioPair:P,audioMouseHover:G,audioClick:O,audioGameOver:q,audioMap:c}}const y=e=>i(u,`users/${e}`),$=i(u,"ranking"),j=w("user",{state:()=>({user:null}),getters:{getUser:e=>{if(e.user)return e.user;const r=localStorage.getItem("user");if(!r)return null;try{const o=JSON.parse(r);if(o&&typeof o=="object")return o}catch(o){return console.error("Erro ao fazer parse do usuário:",o),null}}},actions:{setUser(e){localStorage.setItem("user",JSON.stringify(e)),this.user=e},async addUser(e,r){try{await m(y(e),r)}catch(o){console.error("Erro ao adicionar usuário:",o)}},async getUserData(e){try{const r=await p(y(e));return r.exists()?r.val():null}catch(r){return console.error("Erro ao obter usuário:",r),null}},async getTop10Ranking(){try{const e=C($,M("score"),R(10)),r=await p(e);if(r.exists()){const o=r.val();return Object.entries(o).map(([a,t])=>({...t,id:a})).sort((a,t)=>(t.score??0)-(a.score??0))}else return[]}catch(e){return console.error("Erro ao obter ranking:",e),[]}},async loginWithGoogle(){try{const e=h(),r=new U,o=await b(e,r),a={nome:o.user.displayName,email:o.user.email,photoURL:o.user.photoURL,uid:o.user.uid};await this.getUserData(o.user.uid)||(await this.addUser(o.user.uid,a),await this.addRaking(o.user.uid,{score:0,gameTotal:0,attemptCounter:0,...a})),this.setUser(a)}catch(e){console.error("Erro no login com Google:",e)}},async logout(){try{const e=h();await S(e),this.user=null,localStorage.removeItem("user"),location.href="/"}catch(e){console.error("Erro ao fazer logout:",e)}},async addRaking(e,r){try{await m(i(u,`ranking/${e}`),r)}catch(o){console.error("Erro ao adicionar ranking:",o)}},async updateRanking(e,r){try{const o=i(u,`ranking/${e}`),a=await p(o),t=a.exists()?a.val():null,k={attemptCounter:t.attemptCounter+r.attemptCounter,gameTotal:t.gameTotal+r.gameTotal,score:t.score+r.score};await _(o,k)}catch(o){console.error("Erro ao atualizar ranking:",o)}}}});export{N as a,j as u};
